= Reqstool Gradle Plugin
:toc:
:toc-placement!:

image:https://img.shields.io/badge/License-MIT-blue.svg[License,link=LICENSE]

Gradle plugin for assembling and attaching reqstool ZIP artifacts. This plugin mimics the behavior of the link:https://github.com/Luftfartsverket/reqstool-java-maven-plugin[reqstool-java-maven-plugin].

toc::[]

== Features

* *Zero-configuration*: Works out of the box with sensible defaults
* *Automatic lifecycle integration*: Runs as part of the standard `build` task
* *Maven publishing support*: Automatically registers ZIP artifact for publication
* *Combines annotations*: Merges requirements annotations from implementation and test code
* *Assembles ZIP artifact*: Creates structured ZIP containing requirements, test results, and configuration

== Quick Start

=== Apply the Plugin

[source,gradle]
----
plugins {
    id 'se.lfv.reqstool' version '1.0.0'
}
----

=== Default Behavior

The plugin automatically:

1. Runs after the `check` task (when tests complete)
2. Combines annotation files from `build/generated-sources/` and `build/generated-test-sources/`
3. Creates a ZIP artifact in `build/reqstool/` containing:
   * `requirements.yml` (from `./reqstool/` directory)
   * `software_verification_cases.yml` (optional)
   * `manual_verification_results.yml` (optional)
   * `annotations.yml` (combined/merged annotations)
   * `test_results/` (XML test results from `build/test-results/`)
   * `reqstool_config.yml` (configuration manifest)
4. Registers the ZIP for Maven publication (if `maven-publish` plugin is applied)

=== Minimal Setup

Create a `reqstool/` directory in your project root with a `requirements.yml` file:

----
my-project/
├── build.gradle
├── reqstool/
│   └── requirements.yml  (mandatory)
└── src/
----

Run `gradle build` and the ZIP artifact will be created automatically.

== Configuration

The plugin provides zero-configuration defaults, but you can customize if needed:

[source,gradle]
----
requirementsTool {
    // Path to requirements annotations YAML 
    // Default: build/generated-sources/annotations/resources/annotations.yml
    requirementsAnnotationsFile = file('build/custom-path/annotations.yml')
    
    // Path to SVCS annotations YAML 
    // Default: build/generated-test-sources/test-annotations/resources/annotations.yml
    svcsAnnotationsFile = file('build/custom-path/test-annotations.yml')
    
    // Output directory for ZIP and combined annotations
    // Default: build/reqstool
    outputDirectory = file('build/custom-output')
    
    // Dataset directory containing requirements.yml and optional files
    // Default: ./reqstool
    datasetPath = file('custom-reqstool-data')
    
    // Test result file patterns
    // Default: ['build/test-results/**/*.xml']
    testResults = ['build/test-results/**/*.xml', 'build/custom-tests/**/*.xml']
    
    // Skip entire plugin execution
    // Default: false
    skip = false
    
    // Skip ZIP assembly but keep annotation combining
    // Default: false
    skipAssembleZipArtifact = false
    
    // Skip artifact attachment for publishing
    // Default: false
    skipAttachZipArtifact = false
}
----

== Publishing

When the `maven-publish` plugin is applied, the reqstool ZIP is automatically registered for publication:

[source,gradle]
----
plugins {
    id 'se.lfv.reqstool' version '1.0.0'
    id 'maven-publish'
}

publishing {
    repositories {
        maven {
            url = "https://your-repo.example.com/maven"
        }
    }
}
----

The ZIP artifact will be published with classifier `reqstool` (e.g., `my-app-1.0.0-reqstool.zip`).

== Tasks

=== `assembleRequirements`

Main task that:

* Depends on `check` task (ensures tests have run)
* Combines annotation files
* Assembles ZIP artifact
* Runs automatically as part of `build` task

Run manually:

[source,bash]
----
gradle assembleRequirements
----

== Requirements

* Gradle 6.0+ (tested with Gradle 9.3)
* Java 8+
* A `requirements.yml` file in the dataset directory (default: `./reqstool/`)

== License

MIT License - see link:LICENSE[LICENSE] file for details

== Credits

Based on link:https://github.com/Luftfartsverket/reqstool-java-maven-plugin[reqstool-java-maven-plugin] by Luftfartsverket (LFV).
